{% extends "base.html" %} {% block content %}
<div class="card border-primary">
  <div class="card-header">
    <h3>Scan Report for: {{ results.target }} ({{ results.ip_address }})</h3>
  </div>
  <div class="card-body">
    <div class="accordion" id="reportAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingGeo">
          <button
            class="accordion-button"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapseGeo"
            aria-expanded="true"
            aria-controls="collapseGeo"
          >
            üìç Geolocation & ISP
          </button>
        </h2>
        <div
          id="collapseGeo"
          class="accordion-collapse collapse show"
          aria-labelledby="headingGeo"
          data-bs-parent="#reportAccordion"
        >
          <div class="accordion-body">
            {% if results.geo and results.geo.get('lat') and
            results.geo.get('lon') %}
            <div id="map" style="height: 250px" class="mb-3"></div>
            <script>
              const lat = {{ results.geo.lat }};
              const lon = {{ results.geo.lon }};
              const map = L.map('map').setView([lat, lon], 10);
              L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
              }).addTo(map);
              L.marker([lat, lon]).addTo(map).bindPopup('Approximate Location').openPopup();
            </script>
            {% endif %} {% if results.geo and not results.geo.get('error') %}
            <ul class="list-group">
              <li class="list-group-item">
                <strong>Country:</strong> {{ results.geo.get('country', 'N/A')
                }}
              </li>
              <li class="list-group-item">
                <strong>City:</strong> {{ results.geo.get('city', 'N/A') }}
              </li>
              <li class="list-group-item">
                <strong>ISP:</strong> {{ results.geo.get('isp', 'N/A') }}
              </li>
            </ul>
            {% elif results.geo.get('error') %}
            <p class="text-danger">{{ results.geo.get('error') }}</p>
            {% else %}
            <p>Geolocation data is not available.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingReputation">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapseReputation"
            aria-expanded="false"
            aria-controls="collapseReputation"
          >
            üö¶ IP Reputation & Blacklist
          </button>
        </h2>
        <div
          id="collapseReputation"
          class="accordion-collapse collapse"
          aria-labelledby="headingReputation"
          data-bs-parent="#reportAccordion"
        >
          <div class="accordion-body">
            {% if results.blacklist and not results.blacklist.error %}
            <ul class="list-group">
              <li class="list-group-item">
                <strong>Abuse Confidence Score:</strong> {{
                results.blacklist.get('abuseConfidenceScore', 0) }}%
                <div class="progress" style="height: 10px">
                  <div
                    class="progress-bar {% if results.blacklist.get('abuseConfidenceScore', 0) > 75 %}bg-danger{% elif results.blacklist.get('abuseConfidenceScore', 0) > 25 %}bg-warning{% else %}bg-success{% endif %}"
                    role="progressbar"
                    style="width: {{ results.blacklist.get('abuseConfidenceScore', 0) }}%;"
                    aria-valuenow="{{ results.blacklist.get('abuseConfidenceScore', 0) }}"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>
              </li>
              <li class="list-group-item">
                <strong>Total Reports:</strong> {{
                results.blacklist.get('totalReports', 'N/A') }}
              </li>
            </ul>
            {% else %}
            <p>Could not retrieve reputation details.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingPorts">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapsePorts"
            aria-expanded="false"
            aria-controls="collapsePorts"
          >
            üöÄ Open Ports
          </button>
        </h2>
        <div
          id="collapsePorts"
          class="accordion-collapse collapse"
          aria-labelledby="headingPorts"
          data-bs-parent="#reportAccordion"
        >
          <div class="accordion-body">
            {% if results.ports %}
            <ul class="list-group">
              {% for port in results.ports %}
              <li class="list-group-item">{{ port }}</li>
              {% endfor %}
            </ul>
            {% else %}
            <p>No common ports seem to be open.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingHeaders">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapseHeaders"
            aria-expanded="false"
            aria-controls="collapseHeaders"
          >
            üåê HTTP Headers
          </button>
        </h2>
        <div
          id="collapseHeaders"
          class="accordion-collapse collapse"
          aria-labelledby="headingHeaders"
          data-bs-parent="#reportAccordion"
        >
          <div class="accordion-body">
            {% if results.headers and not results.headers.error %}
            <p>
              <strong>Status:</strong> {{ results.headers.get('status_code')
              }}<br /><strong>Final URL:</strong> {{
              results.headers.get('final_url') }}
            </p>
            <ul class="list-group">
              {% for key, value in results.headers.get('headers', {}).items() %}
              <li class="list-group-item">
                <strong>{{ key }}:</strong> {{ value }}
              </li>
              {% endfor %}
            </ul>
            {% else %}
            <p>Could not retrieve HTTP headers.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingDns">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapseDns"
            aria-expanded="false"
            aria-controls="collapseDns"
          >
            üìÑ DNS Records
          </button>
        </h2>
        <div
          id="collapseDns"
          class="accordion-collapse collapse"
          aria-labelledby="headingDns"
          data-bs-parent="#reportAccordion"
        >
          <div class="accordion-body">
            {% for type, records in results.dns.items() %}{% if records
            %}<strong>{{ type }} Records:</strong>
            <ul>
              {% for record in records %}
              <li>{{ record }}</li>
              {% endfor %}
            </ul>
            {% endif %}{% endfor %}
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingSubdomains">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapseSubdomains"
            aria-expanded="false"
            aria-controls="collapseSubdomains"
          >
            üîé Discovered Subdomains
          </button>
        </h2>
        <div
          id="collapseSubdomains"
          class="accordion-collapse collapse"
          aria-labelledby="headingSubdomains"
          data-bs-parent="#reportAccordion"
        >
          <div class="accordion-body">
            {% if results.subdomains %}
            <ul class="list-group">
              {% for subdomain in results.subdomains %}
              <li class="list-group-item">{{ subdomain }}</li>
              {% endfor %}
            </ul>
            {% else %}
            <p>No common subdomains were found for this target.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingWhois">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapseWhois"
            aria-expanded="false"
            aria-controls="collapseWhois"
          >
            üë§ WHOIS Information
          </button>
        </h2>
        <div
          id="collapseWhois"
          class="accordion-collapse collapse"
          aria-labelledby="headingWhois"
          data-bs-parent="#reportAccordion"
        >
          <div class="accordion-body">
            {% if results.whois and not results.whois.get('error') %}
            <ul class="list-group">
              {% if results.whois.get('registrar') %}
              <li class="list-group-item">
                <strong>Registrar:</strong> {{ results.whois.get('registrar',
                'N/A') }}
              </li>
              <li class="list-group-item">
                <strong>Creation Date:</strong> {{
                results.whois.get('creation_date', 'N/A') }}
              </li>
              <li class="list-group-item">
                <strong>Expiration Date:</strong> {{
                results.whois.get('expiration_date', 'N/A') }}
              </li>
              <li class="list-group-item">
                <strong>Name Servers:</strong> {{
                results.whois.get('name_servers', []) | join(', ') }}
              </li>
              {% elif results.whois.get('asn_description') %}
              <li class="list-group-item">
                <strong>ASN Description:</strong> {{
                results.whois.get('asn_description', 'N/A') }}
              </li>
              <li class="list-group-item">
                <strong>Network Description:</strong> {{
                results.whois.get('nets', 'N/A') }}
              </li>
              {% else %}
              <li class="list-group-item">
                Detailed WHOIS data could not be parsed.
              </li>
              {% endif %}
            </ul>
            {% elif results.whois.get('error') %}
            <p class="text-danger">
              <strong>Error:</strong> {{ results.whois.get('error') }}
            </p>
            {% else %}
            <p>Could not retrieve WHOIS information.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header" id="headingSsl">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapseSsl"
            aria-expanded="false"
            aria-controls="collapseSsl"
          >
            üõ°Ô∏è SSL Certificate Information
          </button>
        </h2>
        <div
          id="collapseSsl"
          class="accordion-collapse collapse"
          aria-labelledby="headingSsl"
          data-bs-parent="#reportAccordion"
        >
          <div class="accordion-body">
            {% if results.ssl and not results.ssl.error %}
            <ul class="list-group">
              <li class="list-group-item">
                <strong>Issuer:</strong> {{ results.ssl.issuer.get('commonName',
                'N/A') }}
              </li>
              <li class="list-group-item">
                <strong>Subject:</strong> {{
                results.ssl.subject.get('commonName', 'N/A') }}
              </li>
              <li class="list-group-item">
                <strong>Valid From:</strong> {{ results.ssl.valid_from }}
              </li>
              <li class="list-group-item">
                <strong>Valid Until:</strong> {{ results.ssl.valid_until }}
              </li>
            </ul>
            {% else %}
            <p>
              {{ results.ssl.get('error', 'Could not retrieve SSL certificate
              details.') }}
            </p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
